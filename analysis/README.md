## Sliding window tree analysis

#### convert vcf files to fasta alignments
* install mvftools (probably better software to do this but I was trying something else)
* See `array_mvftools_vcf2fasta.sh`

#### split fasta alignments into 50kb stretches
* Perform this on scaffold-by-scaffold basis
* Enables missing data threshold: windows in which an individual has >= proportion of missing data (user-specified) 
* See `create_fasta_window_alignments.py`
    * Example usage:
    * `python3 create_fasta_window_alignments.py alignment.scaffold_1085.fa 100000 scaffold_1085`

#### estimate trees (and models of nucleotide substitution) for each 50kb stretch with iqtree
* Perform with array script
* P. montanus as outgroup
* See `array_iqtree_50kb_windows.sh`


#### make species tree in ASTRAL with 50kb window trees
* first, cat gene trees for each window into a single tree file
```shell
cd 50kb_alignments
for i in *;
do
    cat $i/*.treefile >> combined_50kb_trees.tre
done
```
* also, keep a log of which trees were catted to the treefile, and in what order. This will come in handy later.
```shell
for i in *_window;
do
    echo $i/*.treefile | tr " " "\n" >> tmpout.txt
done
cat --number tmpout.txt > numbered_treepaths.txt
rm tmpout.txt
```
* then, set up namefile, to assign taxa in gene trees to species tree
    * see `namemap_astral_v1.txt`
* run ASTRAL
    * see `run_astral_50kb_windows.sh`
    * Also see `run_astral_50kb_windows_no-namemap.sh`



## Sliding window dxy, Fst, and pi
#### Estimate diversity and divergence metrics with pixy
* Make population file, which assigns each individual in the analysis to a population (species)
    * See `popfile_pixy.txt`
* Run pixy along each major scaffold in windows of 50kb (same size as sliding window trees)
    * See `array_pixy_50kb_windows.sh`
* Plot results with [`plot_pixy_output.R`](https://github.com/benstemon/dasanthera_novaseq/blob/main/analysis/analysis_pixy_50kb/plot_pixy_output.R)



## Concordance factors: Which regions alongs scaffolds have histories supporting close relationship between _P. newberryi_ and _P. rupicola_ (as opposed to _P. newberryi_ and _P. cardwellii_ as sister taxa)
#### Identify support for nodes in the species tree and identify discordant gene tree topologies of interest with gene concordance factors in iqtree
* Run concordance factor analysis, using "no-namemap" tree generated by ASTRAL as reference tree
    * See `run_concordance_factor_50kb_windowtree_nomap.sh`
* Identify the node of interest (node joining _P. newberryi_ and _P. cardwellii_ as sister taxa)
    * Node identified: 29
* Identify GDF placing _P. newberryi_ and _P. rupicola_ in clade to the exclusion of other taxa (including _P. cardwellii_)
    * GDF = 1
* Use stat_tree output to identify which specific gene trees support GDF 1, and match those trees to the numbered_treepaths output to identify specific discordant gene trees of interest.
    * Identified 105 discordant trees.
    * See script: `ID_discordant_trees.py` and output: `discordant_trees.txt`



## D-statistics and related metrics
* Using Dsuite to calculate various metrics related to introgression
* Using an input tree to additionally test for significance of D with respect to tree topology. Tree for input here is the MLE tree for concatenated species tree, rooted with P. montanus and P. lyallii as outgroups (same as sliding windows 10kb astral tree)